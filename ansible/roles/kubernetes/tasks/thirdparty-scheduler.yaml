---

- name: Ensure binary scheduler is running
  become: yes
  service: name=hyperkube-binary-scheduler state=started enabled=yes
  when: "hyperkube_deployment_mode == 'binary'"

- name: Ensure dockerized scheduler is running
  become: yes
  service: name=hyperkube-docker-master state=started enabled=yes
  when: "hyperkube_deployment_mode == 'docker'"

- name: Create third party scheduler pod
  become: yes
  shell: >
    /opt/bin/kubectl --kubeconfig={{ kubelet.kubeconfig | expanduser }} create -f /opt/bin/kraken-services-rendered/{{ thirdparty_scheduler }} || /opt/bin/kubectl --kubeconfig={{ kubelet.kubeconfig | expanduser }} apply -f /opt/bin/kraken-services-rendered/{{ thirdparty_scheduler }}
  register: pod_result
  until: pod_result.rc == 0
  retries: 100
  delay: 5

- name: Shut down binary scheduler
  become: yes
  service: name=hyperkube-binary-scheduler state=stopped enabled=yes
  when: "hyperkube_deployment_mode == 'binary'"

- name: Modify dockerized scheduler
  become: yes
  file: path=/opt/bin/manifests/scheduler.json state=absent
  when: "hyperkube_deployment_mode == 'docker'"

- name: Restart dockerized contorller manager pod scheduler
  become: yes
  service: name=hyperkube-docker-master state=restarted enabled=yes
  when: "hyperkube_deployment_mode == 'docker'"